# 1. Getting alignment
The alignments generated by MAFFT when using the bash script provided 
in `aln` can be found in directories `2` to `6` (download from 
[here](https://www.dropbox.com/s/seqc0qbwuxk8ev2/SeqBayesS2_filteraln2_ctenohystrica_01_mafft.zip?dl=0), 
which also contain the data that you should have when you finish to run all the code provided 
in this tutorial)
They were generated using the option `--add` so the new sequence was aligned to the current 
alignment for this data subset (rodentia ctenohystrica).

>>**NOTE:** The alignments file names do not start with "rodentia_ctenohystrica". Instead,
>>they start with "ctenohystrica". They were renamed to have shorter file names and avoid 
>>path issues because of having very long names.

To get the fasta sequences in one line, we can run the following code:

```sh
# Run from `01_mafft/aln`
for i in `seq 2 6`
do

cd $i 
fasta=$( echo *outforMAFFT_out.fasta )
printf "Parsing "$fasta"...\n"
../../../../../../../../../src/one_line_fasta.pl $fasta
grep '>' $fasta | sed 's/>//' > species.txt
mkdir out_mafft 
mv $fasta out_mafft
fa=$( ls *fa )
name=$( echo $fa | sed 's/\_out..*//' )
mv $fa $name".fasta"
cd ../

done
```

Then, we used the file `species.txt` output for each of the alignments (one partition per alignment) to check 
that the order of the taxa was the same:

```sh
# Run from `01_mafft/aln`
diff 2/species.txt 3/species.txt 
diff 2/species.txt 4/species.txt 
diff 2/species.txt 5/species.txt 
diff 2/species.txt 6/species.txt 
```

Once we made sure that the order was the same ,
we had to generate the `sequences.txt` file alone without the `>species` header, otherwise the header 
will be duplicated:

```sh
# Run from `01_mafft/aln`
for i in `seq 2 6`
do 

cd $i 
perl ../../only_sequences.pl *fasta
cd ..

done
```

Now, we can concatenate the sequences in the same order that had been previously done 
(i.e., mt12cp > mt3cp > mtrna > nt12cp > nt3cp):

```sh
# Run from `01_mafft/aln`
mkdir 1
cd 1
paste -d "" ../2/*fasta ../3/cteno*seq*txt > ctenohystrica.fasta 
paste -d "" ctenohystrica.fasta ../4/cteno*seq*txt > ctenohystrica2.fasta 
paste -d "" ctenohystrica2.fasta ../5/cteno*seq*txt > ctenohystrica3.fasta 
paste -d "" ctenohystrica3.fasta ../6/cteno*seq*txt > ctenohystrica4.fasta
rm ctenohystrica.fasta ctenohystrica2.fasta ctenohystrica3.fasta
mv ctenohystrica4.fasta ctenohystrica.fasta
```

Now, the last step is to convert the FASTA files into PHYLIP format:

```sh
# Run from `01_mafft/aln`
for i in `seq 1 6`
do 

cd $i
num=$( grep '>' *fasta | wc -l )
len=$( sed -n '2,2p' *fasta | sed 's/\r//' | sed 's/\n//' | wc --m )
perl ../../FASTAtoPHYL.pl *fasta $num $len 
cd ..

done
```

Last, generate the file with the five partitions concatenated:

```sh
# Run from `01_mafft/aln`
mkdir 7 
cd 7 

for i in `seq 2 6`
do 

cat ../$i/*aln >> ctenohystrica_5parts.aln
printf "\n\n" >> ctenohystrica_5parts.aln

done 
```
